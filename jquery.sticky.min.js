/**
 * Sticky
 * 
 * Keep interface elements fixed in place as the user scrolls.
 * 
 * Copyright (c) 2011 Kevin Thompson <http://kevinthompson.info>
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * @author:   Kevin Thompson <kevin@kevinthompson.info>
 * @version:  1.0
**/ 
(function(a){a.fn.sticky=function(b){var c={offset:20,mode:"fixed",stopper:"",speed:500,classes:{element:"jquery-sticky-element",start:"jquery-sticky-start",sticky:"jquery-sticky-sticky",stopped:"jquery-sticky-stopped",placeholder:"jquery-sticky-placeholder"},onStick:"",onStart:"",onStop:""};this.each(function(){if(b){a.extend(c,b)}if(a(this).parent().hasClass(c.classes.element)){return}var f=a(document);var e=a(window);var d={init:function(j){c.mode=(a.browser.msie&&c.mode=="fixed"?c.mode="animate":c.mode);j.wrap('<div class="'+c.classes.element+'" />');d.element=j.parent();d.units={start:d.element.offset().top};if(c.stopper!=""){var k=a(c.stopper);if(k.length>0){var g=0;while(g<k.length&&typeof(d.stopper)=="undefined"){if(a(k[g]).offset().top>d.element.offset().top+d.element.outerHeight()){d.stopper=a(k[g])}g++}}if(typeof(d.stopper)!="undefined"&&d.stopper.length>0){var h=(parseInt(d.stopper.css("margin-top"))!=undefined?parseInt(d.stopper.css("margin-top")):0);d.units.stop=d.stopper.offset().top-h}}d.placeholder=d.element.clone().empty().attr("class",c.classes.placeholder).css({opacity:0,height:d.element.height()}).insertAfter(d.element);d.element.appendTo("body").css({width:d.placeholder.width(),left:d.placeholder.offset().left,top:d.placeholder.offset().top,"margin-bottom":"0px",position:"absolute","z-index":"999"});e.bind("resize scroll",function(){d.update()});d.update()},update:function(){d.element.css({width:d.placeholder.width(),left:d.placeholder.offset().left});d.placeholder.css("height",d.element.height());if((d.element.outerHeight()+c.offset)<e.height()){d.units.doctop=f.scrollTop();if(d.element.hasClass(c.classes.sticky)&&c.mode=="animate"){d.animate(d.units.doctop+c.offset)}if(typeof(d.stopper)!="undefined"&&d.stopper.length>0){var g=(parseInt(d.stopper.css("margin-top"))!=undefined?parseInt(d.stopper.css("margin-top")):0);d.units.stop=d.stopper.offset().top-g}if(!d.element.hasClass(c.classes.stopped)&&typeof(d.stopper)!="undefined"&&d.stopper.length>0&&(d.units.doctop+c.offset+d.element.outerHeight())>=d.units.stop){d.stop(d.units.stop-d.element.outerHeight(),"stop");if(typeof c.onStop=="function"){c.onStop()}}else{if(!d.element.hasClass(c.classes.sticky)&&d.units.doctop>(d.units.start-c.offset)&&(typeof(d.stopper)=="undefined"||d.stopper.length==0||(d.stopper.length>0&&(d.units.doctop+c.offset+d.element.outerHeight())<d.units.stop))){d.stick(c.offset);if(c.mode=="animate"){d.animate(d.units.doctop+c.offset)}if(typeof c.onStick=="function"){c.onStick()}}else{if(!d.element.hasClass(c.classes.start)&&d.units.doctop<=(d.units.start-c.offset)){d.stop(d.units.start,"start");if(typeof c.onStart=="function"){c.onStart()}}}}}else{if(!d.element.hasClass(c.classes.start)){d.stop(d.units.start,"start")}}},animate:function(g){clearTimeout(d.timer);d.timer=setTimeout(function(){if(g>=d.units.stop){g=d.units.stop-d.element.outerHeight()}else{if(g<=d.units.start){g=d.units.start}}d.element.stop().animate({top:g},c.speed)},100)},stick:function(g){d.element.removeClass(c.classes.start).removeClass(c.classes.stopped).addClass(c.classes.sticky);if(c.mode=="fixed"){d.element.css({top:g,position:"fixed"})}},stop:function(j,g){var h=(g=="start"?c.classes.stopped:c.classes.start);var i=(g=="stop"?c.classes.stopped:c.classes.start);d.element.removeClass(c.classes.sticky).removeClass(h).addClass(i);if(c.mode=="fixed"){d.element.css({top:j,position:"absolute"})}else{d.animate(g=="start"?d.units.start:d.units.stop-d.element.outerHeight())}}};d.init(a(this))})}})(jQuery);